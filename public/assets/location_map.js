$(document).ajaxSend(function(e,t){var i=$("meta[name='csrf-token']").attr("content");t.setRequestHeader("X-CSRF-Token",i)}),window.App={Models:{},Collections:{},Views:{}},App.Router=Backbone.Router.extend({routes:{"":"index"},initialize:function(){Backbone.history.start();var e=new App.Models.Location;App.main=new App.Views.Main({model:e})},index:function(){console.log("bb router index");{var e=new App.Collections.Locations;new App.Views.LocationsView({collection:e})}}}),App.Models.Location=Backbone.Model.extend({urlRoot:"/locations",validate:function(e){var t=[];return(""===e.name||""===e.address||""===e.address_detail||""===e.city||""===e.state||""===e.zipcode||""===e.description)&&t.push("Please fill in all fields!"),t.length>0?t:void 0}}),App.Collections.Locations=Backbone.Collection.extend({url:"/locations",model:App.Models.Location,initialize:function(){this.fetch()}}),App.Views.LocationsView=Backbone.View.extend({el:"#locations",events:{"click li":"detail"},initialize:function(){this.listenTo(this.collection,"sync add remove",this.render)},render:function(){var e=$("#locations-template").html(),t=Handlebars.compile(e),i=this.collection.toJSON(),o=t({devLocations:i});this.$el.html(o)},detail:function(e){var t=$(e.currentTarget).data("id"),i=this.collection.get(t),o=$("#detail-template").html(),n=Handlebars.compile(o),a=n(i.toJSON());this.$el.html(a)}}),App.Views.Main=Backbone.View.extend({el:"#side_nav",initialize:function(){console.log("initialized main.js"),this.locationForm=new App.Views.LocationForm({model:this.model})}}),App.Views.LocationForm=Backbone.View.extend({el:"#location_form",events:{"submit form":"createLocation"},initialize:function(){this.name=$("#location_name"),this.address=$("#location_address"),this.address_detail=$("#location_address_detail"),this.city=$("#location_city"),this.state=$("#location_state"),this.zipcode=$("#location_zipcode"),this.description=$("#location_description"),this.listenTo(this.model,"invalid",this.displayErrors)},createLocation:function(){console.log("form submitted"),this.model.set(this.getAttributes())},getAttributes:function(){return{name:this.name.val(),address:this.address.val(),address_detail:this.address_detail.val(),city:this.city.val(),state:this.state.val(),zipcode:this.zipcode.val(),description:this.description.val()}},displayErrors:function(){$("#errors").text(this.model.validationError)}}),App.Views.LocationView=Backbone.View.extend({el:"#detail",initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){var e=$("#detail-template").html(),t=Handlebars.compile(e);this.$el.html(t(this.model.toJSON))}}),$(document).ready(function(){"/"===window.location.pathname?Map.initHome():Map.initShow()}),Map=function(e){var t={center:new google.maps.LatLng(e.latitude,e.longitude),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}]};this.googleMap=new google.maps.Map(document.getElementById("gmap-canvas"),t)},Map.getLocation=function(){return $.ajax({dataType:"json",type:"GET",url:window.location.pathname})},Map.getLocations=function(){return $.ajax({dataType:"json",type:"GET",url:"/locations"})},Map.prototype.addPin=function(e){var t=new google.maps.LatLng(e.latitude,e.longitude),i=new google.maps.Marker({position:t,title:e.name});i.setMap(this.googleMap)},Map.initHome=function(){navigator.geolocation.getCurrentPosition(function(e){var t={latitude:e.coords.latitude,longitude:e.coords.longitude},i=new Map(t);i.addPin(t),Map.getLocations().done(function(e){for(var t=($("#nearby-location-container"),0);t<e.length;t++){var o=e[t];i.addPin(o)}var n=$("#map-result").html(),a=Handlebars.compile(n),s={locations:e},l=a(s);$("#nearby-location-container").append(l)})})},Map.initShow=function(){Map.getLocation().done(function(e){var t=new Map(e);t.addPin(e)})},$(document).ready(function(){App.router=new App.Router,$("#flash_notice").delay(500).fadeIn("normal",function(){$(this).delay(2e3).fadeOut()})});